# PROMPT 04 â€” GENERATE DOCUMENTATION PACK\n\nYou are generating the complete TourKit documentation so it is reusable across projects and understandable at a glance.\n\n## Pre-flight (required)\n\nRead ALL of these files before writing any documentation. If a file is MISSING, note it in a "Missing Files" section at the top of README.md and tell the user which prompt to run. Do NOT hallucinate content for missing files.\n\n**Required files:**\n- `/tourkit/docs/ANCHOR_EVENT_PLAN.md`\n- `/tourkit/docs/NAMING.md`\n- `/tourkit/docs/PURPOSE.md`\n- `/tourkit/docs/BOOTSTRAP.md`\n- `/tourkit/docs/INSTRUMENT_LOG.md`\n- `/tourkit/docs/VALIDATION_REPORT.md`\n- `/tourkit/config/routes.json`\n- `/tourkit/config/events.json`\n- `/tourkit/maps/tour.map.json`\n- `/tourkit/maps/TOUR_MAP.md`\n- `/tourkit/schema/tour.schema.json`\n- `/tourkit/runner/runTour.ts`\n- `/tourkit/scripts/generate-tour-map.ts`\n- `/tourkit/scripts/generate-tour-from-guide.ts`\n- `/tourkit/scripts/doctor.ts`\n- `package.json`\n- `playwright.config.*`\n- `.gitignore`\n- `/tourkit/.env.tourkit.example`\n\n**Also check for:**\n- Any guide files in `/tourkit/guides/`\n- Any fragment files in `/tourkit/guides/_fragments/`\n- Any tour JSON files in `/tourkit/tours/`\n- Any existing artifact runs in `/tourkit/artifacts/`\n\n---\n\n## Documentation principles\n\n- Use REAL file paths, commands, and examples from this repo (read from the files, don't invent)\n- Read `package.json` scripts and document them EXACTLY as they exist\n- Keep docs practical and example-heavy\n- Use Windows-friendly command examples\n- When referencing the same concept in multiple docs, pick ONE canonical location and cross-reference from others (don't duplicate explanations)\n\n---\n\n## Required output files\n\n### 1) `/tourkit/docs/README.md`\n\nThe main entry point. Include:\n\n**60-second Quickstart:**\n```\n1. cp tourkit/.env.tourkit.example tourkit/.env.tourkit\n2. Edit tourkit/.env.tourkit (fill E2E_EMAIL and E2E_PASSWORD)\n3. npm run tourkit:doctor\n4. npm run tour:<first-tour-id>\n```\n(Use the actual first tour ID from the repo.)\n\n**First run setup:**\n- Copy `.env.tourkit.example` to `.env.tourkit`\n- Fill in credentials\n- Run doctor to verify\n\n**Folder structure overview:** List every folder under `/tourkit/` with a one-line description\n\n**Available npm commands:** Read from `package.json` and list all `tour:*` and `tourkit:*` scripts with what they do\n\n**Create a new tour checklist:**\n1. Write a guide in `/tourkit/guides/<tourId>.md`\n2. Run `npm run tourkit:gen -- tourkit/guides/<tourId>.md`\n3. Add npm scripts for the tour\n4. Run `npm run tour:<tourId>:ci`\n5. Fix and retry until it passes\n\n**Recording presets:**\n| Preset | Env settings | Use case |\n|---|---|---|\n| Minimal (default) | `TOURKIT_CAPTURE=0`, `TOUR_OVERLAY=0` | CI runs, just pass/fail |\n| Clean recording | `TOURKIT_CAPTURE=1`, `TOUR_OVERLAY=0` | Marketing videos, clean screenshots |\n| Debug recording | `TOURKIT_CAPTURE=1`, `TOUR_OVERLAY=1` | Debugging anchor placement |\n\nShow exact env edits in `/tourkit/.env.tourkit` for each preset.\n\n**Sanity checklist** (at the end):\n- [ ] `.env.tourkit` exists and is listed in `.gitignore`\n- [ ] `npm run tourkit:doctor` passes (or shows only warnings)\n- [ ] At least one tour exists in `/tourkit/tours/`\n- [ ] Running that tour produces artifacts in `/tourkit/artifacts/`\n- [ ] Clean recording preset (`TOURKIT_CAPTURE=1`, `TOUR_OVERLAY=0`) produces video\n\n### 2) `/tourkit/docs/CONTRACT.md`\n\nThe anchor and event contract. Include:\n\n- Anchor naming grammar with the rule and 5+ examples from this app\n- Event naming grammar with examples\n- Allowed `<type>` values (exhaustive list with descriptions)\n- Required prefixes and why (`tour.` for anchors, `tour.event.` for events)\n- Fragment system: what fragments are, where they live, how to include them\n- Do/Don't rules:\n  - Do not use text selectors in tours\n  - Do not poll DOM for async operations if you can emit an event\n  - Always anchor the interactive element, not a wrapper\n  - Always emit `tour.event.route.ready` after anchors are present\n  - Do not use duplicate anchors on the same page\n\n### 3) `/tourkit/docs/WORKFLOWS.md`\n\nStep-by-step workflows for common tasks. Include:\n\n**Setup workflow (run once):**\nPrompt 00 -> 01 -> 02A -> 02B -> 02C\n\n**Create a new tour (repeatable):**\nPrompt 03 (with specifics on what to provide)\n\n**Add anchors to a new page:**\n1. Plan anchors (update ANCHOR_EVENT_PLAN.md)\n2. Add `data-tour` attributes to components\n3. Add event emissions\n4. Regenerate map: `npm run tourkit:map`\n5. Validate: check map output\n\n**Record clean demo videos:**\n1. Set `TOURKIT_CAPTURE=1` and `TOUR_OVERLAY=0` in `.env.tourkit`\n2. Run the tour: `npm run tour:<tourId>`\n3. Find video in `/tourkit/artifacts/<tourId>/<timestamp>/video.webm`\n\n**Common failure modes and fixes:**\n\n| Symptom | Cause | Fix |\n|---|---|---|\n| "E2E_EMAIL missing" | Env not loaded | Fill `tourkit/.env.tourkit` |\n| "Element detached" | Hydration rerender | `safeClick` handles this; if persistent, add a `waitMs` step |\n| "WaitForEvent timed out" | Event not emitting | Verify `emitTourEvent` call exists in app code |\n| "BaseURL connection refused" | App not running | Check `webServer` block in `playwright.config.ts` |\n| "Overlay in my video" | `TOUR_OVERLAY=1` | Set `TOUR_OVERLAY=0` in `.env.tourkit` |\n| "Anchor not found" | Missing `data-tour` attribute | Add attribute, regenerate map |\n| Auth redirect during map generation | Route is auth-gated | Expected; generator skips these routes |\n\n### 4) `/tourkit/docs/REFERENCE.md`\n\nTechnical reference. Include:\n\n- Full guide DSL grammar (every step type with syntax and examples)\n- Tour JSON schema reference (from `tour.schema.json`, with examples)\n- All npm commands (read from `package.json`)\n- Artifact directory layout\n- Map file formats (`routes.json`, `events.json`, `tour.map.json`)\n- How `TOUR_FILE` env var is used by the harness\n- Capture settings (video/screenshot/trace) and where they're configured\n- Event buffer: how it works, why it exists\n\n### 5) `/tourkit/docs/EXTENDING.md`\n\nHow to extend TourKit. Include:\n\n- **Add a new step type**: What files to modify (schema, generator parser, runner), with a concrete example of adding a hypothetical `assertText` step type\n- **Add a new event**: End-to-end walkthrough (define in events.json, emit in app code, use in guide, regenerate map)\n- **Add a new fragment**: Create file in `_fragments/`, use `Include fragment:` in guides\n- **Port TourKit to another repo**: Checklist of what to copy and configure\n- **Add CI integration**: How to run tours in CI (headless, artifact upload, failure notifications)\n\n### 6) `/tourkit/docs/ARCHITECTURE.md`\n\nHigh-level system overview. Include:\n\n**ASCII diagram:**\n```\nGuide (.md)                    App Source Code\n    |                               |\n    v                               v\n[Generator] <-- validates --> [tour.map.json]\n    |                               ^\n    v                               |\nTour (.json)                   [Map Generator]\n    |                               ^\n    v                               |\n[Runner] ----Playwright----> [Live App + Anchors + Events]\n    |\n    v\n[Artifacts]\n  screens/\n  video.webm\n  trace.zip\n  runlog.txt\n```\n\n**Key integration points:**\n- Where dotenv loads (playwright.config.*)\n- Where the event buffer is installed (runTour, before first navigation)\n- Where artifacts are copied from Playwright output to `/tourkit/artifacts/`\n- Where `TOUR_OVERLAY` is read (TourOverlay component)\n- Where `TOURKIT_CAPTURE` is read (playwright.config.*)\n- Where `TOUR_MODE` is detected (tourMode.ts, URL param + env var)\n\n**File dependency graph:** Which files depend on which other files\n\n---\n\n## Constraints\n\n- Everything saved under `/tourkit/docs/`\n- Use real file paths and commands as they exist in this repo\n- If a referenced file is missing, do NOT invent its contents. List it as missing and note which prompt creates it.\n- Keep each doc focused. When you want to explain something that's covered in another doc, cross-reference: "See [CONTRACT.md](./CONTRACT.md) for anchor naming rules."\n\n---\n\n## Save this prompt\n\nSave THIS EXACT PROMPT verbatim into:\n\n```\n/tourkit/prompts/04-Documentation.md\n```
