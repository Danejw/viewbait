# PROMPT 02C — GENERATE MAP & VALIDATE INSTRUMENTATION\n\nYou are generating the TourKit anchor map by crawling the live app, then validating that everything planned in Prompt 01 was actually implemented in Prompt 02B.\n\n## Pre-flight (required)\n\n1. Verify these files exist:\n   - `/tourkit/config/routes.json` (Prompt 01)\n   - `/tourkit/config/events.json` (Prompt 01)\n   - `/tourkit/docs/ANCHOR_EVENT_PLAN.md` (Prompt 01)\n   - `/tourkit/scripts/generate-tour-map.ts` (Prompt 02A)\n   - `/tourkit/scripts/doctor.ts` (Prompt 02A)\n   - `/tourkit/docs/INSTRUMENT_LOG.md` (Prompt 02B)\n\n   If Prompt 02B files are missing, STOP and tell the user to run Prompt 02B first.\n\n2. Verify the app is reachable:\n   - The `webServer` block in `playwright.config.*` should auto-start it\n   - If not, start it manually and confirm you can reach the base URL\n   - If the app doesn't start, STOP and document the error. Do not proceed with a broken app.\n\n---\n\n## Step 1 — Generate the map\n\nRun the map generator:\n\n```\nnpm run tourkit:map\n```\n\nThis should:\n1. Launch a headless browser\n2. Visit each route from `routes.json` with `?tour=1`\n3. Collect all `data-tour` attributes\n4. Write `/tourkit/maps/tour.map.json`\n5. Write `/tourkit/maps/TOUR_MAP.md`\n\nIf it fails, read the error, fix the generator script, and retry. Common issues:\n- App not running (check webServer config)\n- Auth-gated routes redirecting (the generator should handle this gracefully by skipping)\n- Timeout on slow pages (increase timeout)\n\n---\n\n## Step 2 — Validate: Plan vs. Implementation\n\nCompare what was PLANNED (in `ANCHOR_EVENT_PLAN.md`) against what was FOUND (in `tour.map.json`).\n\nCreate `/tourkit/docs/VALIDATION_REPORT.md` with:\n\n### Anchors\n\nFor each route, list:\n- **Planned and found**: Anchor exists in both the plan and the map. GOOD.\n- **Planned but missing**: Anchor was in the plan but not found in the DOM. This means Prompt 02B missed it or the element isn't rendered on initial load. ACTION REQUIRED.\n- **Found but unplanned**: Anchor exists in the DOM but wasn't in the plan. This is usually fine (extra anchors for future tours) but note it.\n\n### Events\n\nFor events, you cannot validate by crawling (events fire on user action, not page load). Instead, confirm:\n- Every event in `events.json` has a corresponding `emitTourEvent()` call somewhere in the codebase (search for the event name string)\n- Note any events from the plan that have no emission point in the code\n\n### Summary\n\n```\nValidation Summary\n==================\nRoutes checked: 4\nAnchors planned: 18\nAnchors found:   16\nAnchors missing:  2  <-- ACTION REQUIRED\n  - tour.studio.create.form.select.aspectRatio (element not found on /studio)\n  - tour.results.grid.item.thumbnail (results page requires generation first)\nUnplanned anchors: 1\n  - tour.home.nav.link.docs (extra, OK)\nEvents configured: 5\nEvents verified:   5\n```\n\n---\n\n## Step 3 — Fix missing anchors (if any)\n\nIf Step 2 found missing anchors:\n\n1. For each missing anchor, determine WHY it's missing:\n   - Element exists but `data-tour` wasn't added -> Add it now (same pattern as 02B)\n   - Element only renders after user action (e.g., results after generation) -> This is expected; note it as "requires prior action" in the map\n   - Element is in a different component than expected -> Find the right component and add it\n\n2. After fixes, rerun `npm run tourkit:map` and regenerate the validation report\n\n3. Repeat until all "planned but missing" anchors are either:\n   - Found in the map, OR\n   - Documented as "requires prior action" (these will be verified during actual tour runs)\n\n---\n\n## Step 4 — Run the doctor\n\n```\nnpm run tourkit:doctor\n```\n\nAddress any failures. Warnings about env vars are OK if the user hasn't filled them in yet.\n\n---\n\n## Step 5 — Final map review\n\nRead the generated `/tourkit/maps/TOUR_MAP.md` and confirm:\n- Every route in the primary flow has at least the anchors needed for Tour #1\n- The events list includes all events from the plan\n- The anchor naming follows the grammar from `/tourkit/docs/NAMING.md`\n\nIf any anchor names are wrong (don't match the grammar), fix them in BOTH the app code AND the plan, then regenerate the map.\n\n---\n\n## Deliverables checklist\n\n- [ ] `/tourkit/maps/tour.map.json` generated and accurate\n- [ ] `/tourkit/maps/TOUR_MAP.md` generated and readable\n- [ ] `/tourkit/docs/VALIDATION_REPORT.md` comparing plan vs. implementation\n- [ ] All critical anchors either found or documented as "requires prior action"\n- [ ] `npm run tourkit:doctor` passes (warnings OK, no failures)\n- [ ] Any missing anchors fixed and map regenerated\n\n---\n\n## Save this prompt\n\nSave THIS EXACT PROMPT verbatim into:\n\n```\n/tourkit/prompts/02C-Map-Validate.md\n```
