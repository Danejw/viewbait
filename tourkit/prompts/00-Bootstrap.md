# PROMPT 00 — BOOTSTRAP TOURKIT\n\nYou are a coding agent working inside this repo. Your job is to bootstrap TourKit so prompts 01 through 04 can run cleanly with zero guessing.\n\n## Primary outcome\n\nPlaywright is installed and runnable. The `/tourkit/` folder exists with the correct baseline structure, starter docs, and env wiring. A quick verification proves Playwright can launch a browser. Everything is organized under `/tourkit/`.\n\n## Hard constraints\n\n- **NEVER modify, overwrite, or delete the project's existing `.env`, `.env.local`, `.env.example`, or `.env.production` files.** These belong to the app. TourKit has its own env files inside `/tourkit/` (`tourkit/.env.tourkit` and `tourkit/.env.tourkit.example`). The two systems are completely separate.\n- Do not delete or overwrite existing tests, scripts, or Playwright config unless necessary.\n- If Playwright is already installed, do NOT reinstall; verify version and config.\n- Keep all TourKit-related code and docs under `/tourkit/` (except the Playwright test harness which lives under `/tests/e2e/`).\n- Use Windows-friendly commands (this repo is developed on Windows).\n- If you must modify `package.json` scripts, only ADD missing scripts; never remove or rename existing ones.\n- Prefer deterministic, minimal changes.\n\n---\n\n## Step 0 — Repo scan (required before any changes)\n\nInspect the following and record what you find. Do not skip this step.\n\n1. `package.json`:\n   - Is `@playwright/test` already a dependency or devDependency?\n   - Is `dotenv` installed?\n   - Is `cross-env` installed?\n   - Is `tsx` installed? (Required to run `.ts` scripts via `node`-like CLI)\n   - List all existing scripts (you will not touch these).\n\n2. Does `playwright.config.*` exist? If so, note: `baseURL`, `testDir`, `use.video`, `use.trace`, and whether it has a `webServer` block.\n\n3. Does a `tests/e2e/` folder exist? What is in it?\n\n4. Is this a Next.js project? What command starts the dev server (`npm run dev`?) and what port does it use? Check `package.json` scripts and any `.env` or `next.config.*` for port configuration.\n\n5. Check `.gitignore` contents (you will append a line if needed).\n\n6. Does `tsconfig.json` exist? Note the `target` and `module` settings (this affects how TourKit scripts should be written).\n\n7. **List ALL existing `.env*` files at the project root** (e.g., `.env`, `.env.local`, `.env.example`, `.env.production`). Record their names. You MUST NOT modify any of these files at any point during this prompt. They belong to the app. TourKit's env files go inside `tourkit/` and are named differently (`.env.tourkit`, `.env.tourkit.example`).\n\n---\n\n## Step 1 — Install dependencies\n\nInstall each of these as devDependencies ONLY if missing:\n\n| Package | Why |\n|---|---|\n| `@playwright/test` | Test runner for tours |\n| `dotenv` | Loads `/tourkit/.env.tourkit` into `process.env` |\n| `cross-env` | Windows-safe env assignment in npm scripts |\n| `tsx` | Runs `.ts` files directly (required for all TourKit scripts) |\n\nIf `@playwright/test` was just installed OR is already present, run:\n```\nnpx playwright install chromium\n```\n(Install only Chromium to keep it fast. Tours run in one browser.)\n\nIf `@playwright/test` was already present, print the installed version (`npm ls @playwright/test`) and continue.\n\n---\n\n## Step 2 — Create TourKit folder skeleton\n\nCreate this structure. If a folder already exists, leave it alone. Add `.gitkeep` in any empty directory so Git tracks it.\n\n```\n/tourkit/\n  /config/\n  /docs/\n  /maps/\n  /schema/\n  /guides/\n    /_fragments/       <-- shared tour fragments (e.g. login steps)\n  /tours/\n  /runner/\n  /scripts/\n  /app/\n  /artifacts/\n  /prompts/\n```\n\n---\n\n## Step 3 — Env wiring (this is critical, do not skip any part)\n\n### ⛔ HARD CONSTRAINT: Files you must NEVER touch\n\nThe project already has its own env files at the root. These belong to the app, NOT to TourKit. You MUST NOT read, write, modify, rename, delete, or overwrite ANY of these files:\n\n- `/.env` — DO NOT TOUCH\n- `/.env.local` — DO NOT TOUCH\n- `/.env.example` — DO NOT TOUCH\n- `/.env.development` — DO NOT TOUCH\n- `/.env.production` — DO NOT TOUCH\n- Any other `.env*` file at the project root — DO NOT TOUCH\n\nTourKit has its OWN SEPARATE env files that live INSIDE the `/tourkit/` directory. The two env systems are completely independent. TourKit env files are:\n\n| File | Path (MUST be exact) | Purpose |\n|---|---|---|\n| Template | `tourkit/.env.tourkit.example` | Committed to git, shows required keys |\n| Real secrets | `tourkit/.env.tourkit` | Gitignored, user fills in real values |\n\nBoth files go INSIDE the `tourkit/` folder. NOT at the project root. If you find yourself writing to a path that does not start with `tourkit/`, you are doing it wrong.\n\n### A) Create `tourkit/.env.tourkit.example`\n\nWrite this file using Node.js to guarantee the correct path on all platforms:\n\n```js\nconst fs = require("fs");\nconst path = require("path");\n\nconst filePath = path.join("tourkit", ".env.tourkit.example");\n\n// Safety check: this must be inside tourkit/\nif (!filePath.startsWith("tourkit")) {\n  throw new Error("Wrong path! Must be inside tourkit/ folder");\n}\n\nconst content = `# TourKit environment configuration\n# Copy this file to .env.tourkit (same folder) and fill in real values.\n# This file is committed to git. The .env.tourkit file is gitignored.\n\n# App URL (must match your dev server)\nPLAYWRIGHT_BASE_URL=http://localhost:3000\n\n# Tour behavior\nTOUR_MODE=tour_mode\nTOUR_OVERLAY=0\nTOURKIT_CAPTURE=0\n\n# Auth credentials for tour runs (REQUIRED)\nE2E_EMAIL=your_test_email@example.com\nE2E_PASSWORD=your_test_password\n`;\n\nfs.writeFileSync(filePath, content, "utf-8");\nconsole.log("Created:", path.resolve(filePath));\n```\n\nAfter creating, verify the file exists at the correct location:\n```bash\n# This MUST print the file contents. If it errors, the file is in the wrong place.\ncat tourkit/.env.tourkit.example\n```\nOn Windows: `type tourkit\.env.tourkit.example`\n\n### B) Create `tourkit/.env.tourkit` (from the example)\n\nONLY if `tourkit/.env.tourkit` does NOT already exist, copy the example:\n\n```bash\ncp tourkit/.env.tourkit.example tourkit/.env.tourkit\n```\nOn Windows: `copy tourkit\.env.tourkit.example tourkit\.env.tourkit`\n\nIf `tourkit/.env.tourkit` ALREADY exists, do NOT overwrite it.\n\n### C) VERIFY: Correct files exist in correct locations\n\nRun ALL of these checks. Every one must pass before you continue.\n\n```bash\n# 1. TourKit env files MUST exist inside tourkit/\ncat tourkit/.env.tourkit.example   # Must print TourKit config\ncat tourkit/.env.tourkit           # Must print TourKit config\n\n# 2. Root env files MUST be UNCHANGED (spot-check)\ncat .env                           # Must still contain the APP's original env vars\ncat .env.example                   # Must still contain the APP's original example\n\n# 3. Confirm the root .env does NOT contain TourKit keys\n# If you see E2E_EMAIL or TOURKIT_CAPTURE in the root .env, you broke it. Revert immediately.\n```\n\nIf check 1 fails: go back and create the missing TourKit file.\nIf check 2 fails: you modified a root env file. Revert it with `git checkout .env .env.example .env.local` and redo this step.\nIf check 3 fails: you wrote TourKit vars into the app's env file. Revert and redo.\n\nDo NOT proceed until all three checks pass.\n\n### D) Gitignore\n\nCheck `.gitignore`. If it does not already contain a line that ignores `tourkit/.env.tourkit`, append exactly:\n\n```\n# TourKit secrets (credentials for tour runs)\n/tourkit/.env.tourkit\n```\n\nDo NOT ignore `.env.tourkit.example` (that is the template and should be committed).\n\n### E) Wire dotenv into Playwright config\n\nThis is the key fix: Playwright does NOT automatically load env files. You must load it explicitly.\n\n**If `playwright.config.*` already exists**, make the MINIMAL edits described below. Do NOT rewrite the entire file.\n\n**If no config exists**, create `playwright.config.ts` with the full baseline below.\n\n#### Required additions to the TOP of playwright.config.* (before defineConfig):\n\n```ts\nimport path from "node:path";\nimport dotenv from "dotenv";\n\n// Load TourKit env BEFORE Playwright reads config\ndotenv.config({ path: path.resolve(process.cwd(), "tourkit/.env.tourkit") });\n\n// Fail fast: tours need auth credentials\nconst hasEmail = Boolean(process.env.E2E_EMAIL && process.env.E2E_EMAIL !== "your_test_email@example.com");\nconst hasPassword = Boolean(process.env.E2E_PASSWORD && process.env.E2E_PASSWORD !== "your_test_password");\nif (!hasEmail || !hasPassword) {\n  console.error("\n╔══════════════════════════════════════════════════════╗");\n  console.error("║  TourKit: Missing E2E credentials                    ║");\n  console.error("║                                                      ║");\n  console.error("║  1. Copy tourkit/.env.tourkit.example                 ║");\n  console.error("║     to   tourkit/.env.tourkit                         ║");\n  console.error("║  2. Fill in E2E_EMAIL and E2E_PASSWORD                ║");\n  console.error("╚══════════════════════════════════════════════════════╝\n");\n  console.error(`  E2E_EMAIL present: ${hasEmail}`);\n  console.error(`  E2E_PASSWORD present: ${hasPassword}\n`);\n  process.exit(1);\n}\n```\n\n**IMPORTANT**: Do NOT print the actual secret values. Only print boolean presence.\n\n#### Required config settings (add/adjust ONLY if missing, do not break existing settings):\n\n```ts\nexport default defineConfig({\n  testDir: "./tests/e2e",   // leave as-is if already set\n\n  expect: {\n    timeout: 10_000,        // leave as-is if already set\n  },\n\n  use: {\n    baseURL: process.env.PLAYWRIGHT_BASE_URL ?? "http://localhost:3000",\n\n    // Capture settings: controlled by TOURKIT_CAPTURE env var\n    trace:      process.env.TOURKIT_CAPTURE === "1" ? "on" : "on-first-retry",\n    video:      process.env.TOURKIT_CAPTURE === "1" ? "on" : "retain-on-failure",\n    screenshot: process.env.TOURKIT_CAPTURE === "1" ? "on" : "only-on-failure",\n  },\n\n  // Auto-start the dev server for tour runs\n  // This eliminates the "app not running" failure mode entirely\n  webServer: {\n    command: "npm run dev",    // adjust if the app uses a different start command\n    port: 3000,                // adjust if the app uses a different port\n    reuseExistingServer: true, // don't fail if server is already running\n    timeout: 120_000,          // 2 min for cold starts (Next.js can be slow)\n  },\n});\n```\n\n**Critical**: Discover the correct `command` and `port` from Step 0. If the app uses `npm run dev` on port 3000, use those. If it uses something else, use what you found. Do NOT guess.\n\n---\n\n## Step 4 — Add npm scripts\n\nAdd ONLY if missing. Never delete or rename existing scripts.\n\n```json\n{\n  "tourkit:doctor":  "tsx tourkit/scripts/doctor.ts",\n  "tourkit:map":     "tsx tourkit/scripts/generate-tour-map.ts",\n  "tourkit:gen":     "tsx tourkit/scripts/generate-tour-from-guide.ts",\n  "tour:all":        "playwright test tests/e2e/tourkit.spec.ts --grep @tourkit",\n  "pw:ui":           "playwright test --ui"\n}\n```\n\n**Note**: All scripts use `tsx` (not `node`) because TourKit scripts are TypeScript.\n\n---\n\n## Step 5 — Create stub scripts\n\nCreate minimal stubs so the npm commands don't fail before Prompts 02A/03 implement them. Match the repo's TypeScript conventions.\n\n### `/tourkit/scripts/doctor.ts`\n```ts\nconsole.log("TourKit Doctor not implemented yet. Run Prompt 02A.");\nprocess.exit(0);\n```\n\n### `/tourkit/scripts/generate-tour-map.ts`\n```ts\nconsole.log("Map generator not implemented yet. Run Prompt 02A.");\nprocess.exit(0);\n```\n\n### `/tourkit/scripts/generate-tour-from-guide.ts`\n```ts\nconsole.log("Tour generator not implemented yet. Run Prompt 03.");\nprocess.exit(0);\n```\n\n---\n\n## Step 6 — Create Playwright harness placeholder\n\nIf `/tests/e2e/` does not exist, create it.\n\nCreate `/tests/e2e/tourkit.spec.ts`:\n\n```ts\nimport { test, expect } from "@playwright/test";\n\ntest("@tourkit bootstrap: app loads and env is present", async ({ page }) => {\n  // Verify app is reachable\n  const response = await page.goto("/");\n  expect(response?.ok()).toBeTruthy();\n\n  // Verify TourKit env is loaded (boolean presence only)\n  expect(\n    process.env.E2E_EMAIL,\n    "E2E_EMAIL is missing. Fill tourkit/.env.tourkit"\n  ).toBeTruthy();\n  expect(\n    process.env.E2E_PASSWORD,\n    "E2E_PASSWORD is missing. Fill tourkit/.env.tourkit"\n  ).toBeTruthy();\n});\n```\n\n---\n\n## Step 7 — Create baseline docs\n\n### `/tourkit/docs/PURPOSE.md`\n\nWrite a one-page doc covering:\n- What TourKit is: a Playwright-based system for creating repeatable, guided tours of a web app\n- What problems it solves: brittle text selectors, missed async events, unorganized test artifacts\n- The contract: tours reference only `data-tour` attributes and `tour.event.*` custom events\n- The prompt sequence: 00 (bootstrap) -> 01 (discovery) -> 02A/B/C (library, instrument, map) -> 03 (create tours, repeatable) -> 04 (documentation)\n- Multi-tour architecture: each feature gets its own tour, shared flows (like login) use fragments\n\n### `/tourkit/docs/BOOTSTRAP.md`\n\nWrite a doc covering:\n- What Prompt 00 set up\n- Dependencies installed (Playwright, dotenv, cross-env, tsx)\n- Env wiring: where secrets live (`/tourkit/.env.tourkit`), what is gitignored, how Playwright loads it via dotenv in the config\n- The `webServer` block in Playwright config (auto-starts dev server)\n- Capture/overlay toggles:\n  - `TOURKIT_CAPTURE=1` forces video/screenshot/trace on every run\n  - `TOUR_OVERLAY=1` enables visual anchor overlay in the app (once implemented)\n- Which scripts exist and what they do\n- Verification instructions:\n  1. Fill `/tourkit/.env.tourkit` with real credentials\n  2. Run: `npx playwright test --grep @tourkit`\n  3. Confirm it opens the app and passes\n- Exact next step: run Prompt 01\n\n---\n\n## Step 8 — Verification\n\nRun this command to confirm Playwright works:\n\n```\nnpx playwright test --grep @tourkit\n```\n\n(Do NOT use `--headed` in the agent environment; just confirm it runs and passes.)\n\nIf it fails:\n- Read the error output carefully\n- If it is an env var issue, fix the `.env.tourkit` file\n- If it is a connection issue, check the `webServer` block in `playwright.config.ts`\n- If it is a missing browser, run `npx playwright install chromium`\n- Fix and rerun until it passes\n\n---\n\n## Step 9 — Save this prompt\n\nSave THIS EXACT PROMPT verbatim into:\n\n```\n/tourkit/prompts/00-Bootstrap.md\n```\n\nCreate the folder if it does not exist. Do not paraphrase. Save verbatim.\n\n---\n\n## Deliverables checklist (all must exist when done)\n\n- [ ] `/tourkit/` folder structure (including `/tourkit/guides/_fragments/` and `/tourkit/prompts/`)\n- [ ] `/tourkit/docs/PURPOSE.md`\n- [ ] `/tourkit/docs/BOOTSTRAP.md`\n- [ ] `/tourkit/.env.tourkit.example`\n- [ ] `/tourkit/.env.tourkit` (created from example if missing)\n- [ ] `.gitignore` ignores `/tourkit/.env.tourkit`\n- [ ] `playwright.config.*` loads dotenv, fails fast on missing creds, has `webServer` block, has capture settings\n- [ ] `package.json` has all TourKit scripts (using `tsx`, not `node`)\n- [ ] `tsx` installed as devDependency\n- [ ] Playwright installed + Chromium browser installed\n- [ ] `/tests/e2e/tourkit.spec.ts` placeholder passes\n- [ ] `/tourkit/prompts/00-Bootstrap.md` contains this prompt verbatim
